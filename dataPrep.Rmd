---
title: "dataPrep"
author: "Bertram Hojer"
date: "4/27/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
library(pacman)
p_load(tidyverse, lmerTest)

data <- read_csv("Ass4_data.csv", col_types = cols(ID = col_character()))

data$npause[data$npause == 0] <- NA
data$`speechrate (nsyll/dur)`[data$`speechrate (nsyll/dur)` == 0.0] <- NA

scale0_1 <- function(x, ...){(x - min(x, ...)) / (max(x, ...) - min(x, ...))}

hist(data$Pitch_IQR)

d <- data %>% 
  subset(Language == "dk") %>% 
  mutate(pitchVariability = scale0_1(log(Pitch_IQR)),
         pitchMAD = scale0_1(log(Pitch_MAD)),
         pauseFreq = scale0_1(log(Duration / npause), na.rm = T),
         speechRate = scale0_1(log(`speechrate (nsyll/dur)`), na.rm = T)) %>%
  select(ID, Diagnosis, pitchVariability, pitchMAD, pauseFreq, speechRate)

hist(d$pitchVariability, breaks = 15)
hist(d$pitchMAD, breaks = 15)
hist(d$pauseFreq, breaks = 15)
hist(d$speechRate, breaks = 15)

d[is.na(d)] <- 0

d_grouped <- d %>% 
  group_by(ID) %>%
  summarise(Diagnosis = Diagnosis[1],
            pitchVariability = mean(pitchVariability),
            pitchMAD = mean(pitchMAD),
            pauseFreq = mean(pauseFreq),
            speechRate = mean(speechRate))

d_ASD <- d_grouped %>% slice(1:25)
d_TD <- d_grouped %>% slice(43:67)
d_TEST <- d_grouped %>% slice(26:42)
new_d <- rbind(d_ASD, d_TD)
write_csv(new_d, "pitchScores.csv")

```


# Examining data from single model-run of 500 steps

```{r}
setwd("/Users/bertram/Desktop/folders/Uni/4th/SocCult-Exam/ABM/Social-Cultural-Dynamics")

d <- read_csv("data.csv")

d$Diagnosis <- as.numeric(d$AgentID)
d$Diagnosis <- ifelse(d$Diagnosis < 25, "ASD", "TD")

iterWTF <- d

# modeling conversation_time as predicted by diagnosis
model_conv <- lm(conversation_time ~ Diagnosis, data = d)
summary(model_conv)

# modeling n interactions as predicted by diagnosis
model_interactions <- lm(interactions ~ Diagnosis, data = d)
summary(model_interactions)

# modeling interaction time
model_interaction_time <- lm(interaction_time ~ Diagnosis, data = d)
summary(model_interaction_time)

d %>% 
  subset(Step == "499") %>% 
  group_by(Diagnosis) %>% 
  summarize(mean_interaction = mean(interactions),
            mean_interaction_time = mean(interaction_time),
            change_iqr = mean(change_IQR),
            mean_activity = mean(activity))

# modeling change IQR
model_iqr <- lm(change_IQR ~ Diagnosis, data = d)
summary(model_iqr)
```


# Examining data from batch_run
```{r}
batch_data <- read_csv("batch_data.csv")

batch_data$Diagnosis <- as.numeric(batch_data$AgentId)
batch_data$Diagnosis <- ifelse(batch_data$Diagnosis < 25, "ASD", "TD")

batch_d <- batch_data %>% 
  group_by(AgentId) %>% 
  summarize(mean_interaction = mean(interactions),
            mean_interaction_time = mean(interaction_time),
            change_iqr = mean(change_IQR),
            mean_activity = mean(activity),
            mean_conversation_time = mean(conversation_time),
            Diagnosis = Diagnosis[1])

batch_model <- lmer(interaction_time ~ Diagnosis + (1 | AgentId), data = batch_data)
summary(batch_model)



```


